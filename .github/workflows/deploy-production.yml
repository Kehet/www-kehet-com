name: Production Deployment

on:
  push:
    branches:
      - master
  workflow_dispatch:

permissions:
  contents: write

concurrency: production_environment

jobs:
  run-tests:
    if: github.ref == 'refs/heads/master'
    uses: ./.github/workflows/js-tests.yml

  deploy:
    if: github.ref == 'refs/heads/master'
    needs: run-tests
    uses: Kehet/shared-github-workflows/.github/workflows/deployer-deployment.yml@master
    with:
      php-version: '8.3'
    secrets:
      private-key: ${{ secrets.PRIVATE_KEY }}
